<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Setup Domain Controller on Ubuntu 14.04  &middot; ChenHan&#39;s Tech blog</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="">


<meta property="og:title" content="Setup Domain Controller on Ubuntu 14.04  &middot; ChenHan&#39;s Tech blog ">
<meta property="og:site_name" content="ChenHan&#39;s Tech blog"/>
<meta property="og:url" content="https://swem.github.io/post/2014-09-22-setup-domain-controller-on-ubuntu-1404/" />
<meta property="og:locale" content="en-us">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2014-09-22T11:09:00Z" />
<meta property="og:article:modified_time" content="2014-09-22T11:09:00Z" />

  

  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Setup Domain Controller on Ubuntu 14.04",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2014-09-22",
    "description": "",
    "wordCount": 288
  }
</script>



<link rel="canonical" href="https://swem.github.io/post/2014-09-22-setup-domain-controller-on-ubuntu-1404/" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://swem.github.io/touch-icon-144-precomposed.png">
<link href="https://swem.github.io/favicon.png" rel="icon">

<meta name="generator" content="Hugo 0.22.1" />

  
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link href='https://fonts.googleapis.com/css?family=Merriweather:300%7CRaleway%7COpen+Sans' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="https://swem.github.io/css/font-awesome.min.css">
<link rel="stylesheet" href="https://swem.github.io/css/style.css">
<link rel="stylesheet" href="https://swem.github.io/css/highlight/default.css">

  
  
</head>
<body>
  <main id="main-wrapper" class="container main_wrapper has-sidebar">
    <header id="main-header" class="container main_header">
  <div class="container brand">
  <div class="container title h1-like">
  <a class="baselink" href="https://swem.github.io/">
  Chen-Han (Stanley) Hsiao

</a>

</div>

  
<div class="container topline">
  
  ChenHan&rsquo;s Tech blog


</div>


</div>

  <nav class="container nav primary no-print">
  


  
<a href="https://swem.github.io/about">About</a>

<a href="https://swem.github.io/post" title="Show list of posts">Posts</a>

<a href="https://swem.github.io/tags" title="Show list of tags">Tags</a>


</nav>

<div class="container nav secondary no-print">
  


<a id="contact-link-github" class="contact_link" href="https://github.com/swem">
  <span class="fa fa-github-square"></span><span>github</span></a>





<a id="contact-link-linkedin" class="contact_link" href="https://www.linkedin.com/in/chen-han-hsiao-2b486049">
  <span class="fa fa-linkedin-square"></span><span>linkedin</span></a>



















</div>


  

</header>


<article id="main-content" class="container main_content single">
  <header class="container hat">
  <h1>Setup Domain Controller on Ubuntu 14.04
</h1>

  <div class="metas">
<time datetime="2014-09-22">22 Sep, 2014</time>


  
  &middot; Read in about 2 min
  &middot; (288 Words)
  <br>
  


</div>

</header>

  <div class="container content">
  <p>在ubuntu 14.04 上架設 Samba Domain Controller 的步驟：
1. 安裝 samba libpam-smbpass</p>

<pre><code>sudo apt-get install samba libpam-smbpass
</code></pre>

<p>samba 版本目前是4.1.6 (4.0以上的 Samba 才有提供 Domain Controller 的功能)</p>

<pre><code>samba -V
Version 4.1.6-Ubuntu
</code></pre>

<ol>
<li>使用 samba-tool 一步一步設定，這裡我規劃 samba domain 的網域為 mysamba.test.io
<code>
samba-tool domain provision --use-rfc2307 --interactive
</code></li>
</ol>

<p>設定成功，過程的設定記錄如下：</p>

<pre><code>vagrant@vagrant-ubuntu-trusty-64:~$ sudo samba-tool domain provision --use-rfc2307 --interactive                                                   
Realm: mysamba.test.io
 Domain [mysamba]: 
 Server Role (dc, member, standalone) [dc]: 
 DNS backend (SAMBA_INTERNAL, BIND9_FLATFILE, BIND9_DLZ, NONE) [SAMBA_INTERNAL]: 
 DNS forwarder IP address (write 'none' to disable forwarding) [192.168.1.253]: 192.168.1.253
Administrator password: 
Retype password: 
Looking up IPv4 addresses
More than one IPv4 address found. Using 192.168.1.2
Looking up IPv6 addresses
No IPv6 address will be assigned
Setting up secrets.ldb
Setting up the registry
Setting up the privileges database
Setting up idmap db
Setting up SAM db
Setting up sam.ldb partitions and settings
Setting up sam.ldb rootDSE
Pre-loading the Samba 4 and AD schema
Adding DomainDN: DC=mysamba,DC=test,DC=io
Adding configuration container
Setting up sam.ldb schema
Setting up sam.ldb configuration data
Setting up display specifiers
Modifying display specifiers
Adding users container
Modifying users container
Adding computers container
Modifying computers container
Setting up sam.ldb data
Setting up well known security principals
Setting up sam.ldb users and groups
Setting up self join
Adding DNS accounts
Creating CN=MicrosoftDNS,CN=System,DC=mysamba,DC=test,DC=io
Creating DomainDnsZones and ForestDnsZones partitions
Populating DomainDnsZones and ForestDnsZones partitions
Setting up sam.ldb rootDSE marking as synchronized
Fixing provision GUIDs
A Kerberos configuration suitable for Samba 4 has been generated at /var/lib/samba/private/krb5.conf
Setting up fake yp server settings
Once the above files are installed, your Samba4 server will be ready to use
Server Role:           active directory domain controller
Hostname:              vagrant-ubuntu-trusty-64
NetBIOS Domain:        MYSAMBA
DNS Domain:            mysamba.test.io
DOMAIN SID:            S-1-5-21-711469164-2329730621-2401598146
</code></pre>

<p>附註：在使用 samba-tool 的過程式如果有設定錯誤，想再進行一行 samba-tool 操作，會出現錯誤訊息，提示你必須把 /var/lib/samba/private/sam.ldb /etc/samba/smb.conf 刪除，讓 samba-tool 來重新建立</p>

<pre><code>sudo rm /var/lib/samba/private/sam.ldb
sudo rm /etc/samba/smb.conf
</code></pre>

<p>Ref: <a href="https://wiki.samba.org/index.php/Samba_AD_DC_HOWTO">Samba AD DC HOWTO</a></p>

</div>


  <footer class="container">
  <div class="container navigation no-print">
  <h2>Navigation</h2>
  
  

    
    <a class="prev" href="https://swem.github.io/post/2014-09-20-compile-the-upstart/" title="編譯 Upstart 1.13.2">
      Previous
    </a>
    

    
    <a class="next" href="https://swem.github.io/post/2014-09-23-obtained-with-python-fcntl-file-lock/" title="用python fcntl 取得 file lock">
      Next
    </a>
    

  


</div>

  <div class="container comments">
  <h2>Comments</h2>
  

</div>

</footer>

</article>
      <footer id="main-footer" class="container main_footer">
  

  <div class="container nav foot no-print">
  

  <a class="toplink" href="#">back to top</a>

</div>

  <div class="container credits">
  

  

</div>

</footer>

    </main>
    


<script src="https://swem.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


    
  </body>
</html>

